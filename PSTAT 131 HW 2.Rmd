---
title: "PSTAT 131 HW 2"
author: "Raymond Lee"
date: '2022-04-07'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
abalone = read.csv("abalone.csv")
```

```{r}
library(tidyverse)
library(tidymodels)
tidymodels_prefer()
```

1. 
```{r}
age = abalone$rings+1.5
abalone["age"] = age
hist(age)
```
Age appears to be slightly skewed right.

2. 
```{r}
set.seed(1114)
abalone_split = initial_split(abalone, prop = .80, strata = age)
abalone_train = training(abalone_split)
abalone_test = testing(abalone_split)
```

3. We should not use rings to predict age because age is simply a transformation of rings. 

```{r}
abalone_recipe = recipe(age ~ type + longest_shell + diameter + height +
                          whole_weight + shucked_weight + viscera_weight +
                          shell_weight, data = abalone_train) %>%
  step_dummy(all_nominal_predictors()) %>%
  step_interact(~ starts_with("type"):shucked_weight) %>%
  step_interact(~ longest_shell:diameter) %>%
  step_interact(~ shucked_weight:shell_weight) %>%
  step_normalize(all_predictors())
```

4. 
```{r}
lm_mod = linear_reg() %>% 
  set_engine("lm")
```

5. 
```{r}
lm_wflow = workflow() %>%
  add_model(lm_mod) %>% 
  add_recipe(abalone_recipe)
```

6. 
```{r}
lm_fit = fit(lm_wflow, abalone_train)

lm_fit %>%
  extract_fit_parsnip() %>%
  tidy()

prediction = 11.44461078 + 0.71159854*.5 + 2.27452698*.1 + 0.57539495*.3 +
  5.19625190*4 + -4.18760562*1 + -1.02601690*2 + 1.39323286*1 + 
  -3.08668657*.5*.1 + -0.22000751*1*1
prediction
```

7. 
```{r}
library(yardstick)

set = metric_set(rsq, rmse, mae)

predicted_age = predict(lm_fit, abalone_train)
predicted_actual_ages = tibble(bind_cols(abalone_train["age"], predicted_age))
predicted_actual_ages

set(predicted_actual_ages, truth = age, estimate = .pred)
```
The $R^2$ is 0.5527866, the RMSE is 2.1611731, and the MAE is 1.5670545.
About 55.3% of the variability in age can be explained using type, longest_shell,
diameter, height, whole_weight, shucked_weight, viscera_weight, and shell_weight.